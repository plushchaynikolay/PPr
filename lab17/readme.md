## 1) Рассказать общую схему межпроцессного обмена (перечислить участников, указать порядок действий).

Участники: отправитель, получатель, коммуникатор.
Отправитель указывает буфер с сообщением.
Сообщение копируется в приемный или системный буфер.

В MPI существуют два типа буферов: буфер прикладной программы и системный буфер.

В прикладной программе буфером является та переменная (скалярная или массив), в которую программа записывает данные и адрес которой она указывает системе MPI в качестве источника для отсылки или в качестве приемника для размещения получаемых данных. Система MPI сама не накапливает данные для их совместной пересылки в едином сообщении. Каждый вызов подпрограммы передачи сообщения приводит к пересылке указанных подпрограмме данных, какого бы маленького или большого размера они не были.

Системный буфер служит для копирования данных при асинхронной передаче. Значения из программного буфера копируются в системный буфер, далее инициируется процедура межпроцессорной передачи данных и управление сразу возвращается пользовательской программе. Так как MPI реально будет посылать копию данных, то программа сразу же может использовать переменную-буфер для записи других данных. [\[ссылка\]](http://nmr.phys.spbu.ru/~komolkin/high-perf-4k/web-kurs/mpi-02.html)

https://stackoverflow.com/questions/10850716/what-exactly-happens-when-we-use-mpi-send-receive-functions

## 2) Рассказать про реализованные в MPI классификации механизмов передачи сообщений.

**Блокирующие** - ожидают завершения приема/передачи, и **неблокирующие** - не ожидают.

Передачи классифицируются:
- **Стандартные**: В этом режиме решение о том, будет ли исходящее сообщение буферизовано или нет, принимает MРI. MРI может буферизовать исходящее сообщение. В таком случае операция посылки может завершиться до того, как будет вызван соответствующий прием. С другой стороны, буферное пространство может отсутствовать или MРI может отказаться от буферизации исходящего сообщения из-за ухудшения характеристик обмена. В этом случае вызов send не будет завершен, пока данные не будут перемещены в процесс-получатель.

- **Синхронные**: Посылка, которая использует синхронный (synchronous) режим, может стартовать вне зависимости от того, был ли начат соответствующий прием. Однако, посылка будет завершена успешно, только если соответствующая операция приема стартовала. Следовательно, завершение синхронной передачи не только указывает, что буфер отправителя может быть повторно использован, но также и отмечает, что получатель достиг определенной точки в своей работе, а именно, что он начал выполнение приема. Если и посылка, и прием являются блокирующими операциями, тогда использование синхронного режима обеспечивает синхронную коммуникационную семантику: посылка не завершается на любой стороне обмена, пока оба процесса не выполнят рандеву в процессе операции обмена. Выполнение обмена в этом режиме является нелокальным. 

- **Буферизированные**: передача завершается, когда сообщение копируется в системный буфер; Буферизованный (buffered) режим операции посылки может стартовать вне зависимости от того, инициирован ли соответствующий прием. Однако, в отличие от стандартной посылки, эта операция является локальной и ее завершение не зависит от обстоятельств приема. Следовательно, если посылка выполнена и никакого соответствующего приема не инициировано, тогда MPI обязан буферизовать исходящее сообщение, чтобы позволить завершиться вызову send. Если не имеется достаточного объема буферного пространства, возникнет ошибка. Объем буферного пространства задается пользователем (см. раздел 3.6). Для того, чтобы буферизованный режим был эффективным, может потребоваться распределение буферов пользователем. 

- **По готовности**: инициирование передачи в момент, когда приемник вызывает соответствующий ей прием; Посылка, которая использует режим обмена по готовности (ready communication mode), может быть запущена только тогда, когда прием уже инициирован. В противном случае операция является ошибочной и результат будет неопределенным. На некоторых системах обмен по готовности позволяет устранить необходимость в рандеву, что улучшает характеристики обмена. Завершение операции посылки не зависит от состояния приема и в основном указывает, что буфер посылки может быть повторно использован. Операция посылки, которая использует режим готовности, имеет ту же семантику, как и стандартная или синхронная передача; это означает, что отправитель обеспечивает систему дополнительной информацией (а именно, что прием уже инициирован), которая может уменьшить накладные расходы. Вследствие этого в правильной программе посылка по готовности может быть замещена стандартной передачей без влияния на поведение программы (но не на характеристики).

## 3) Данные какого типа передают все функции MPI? Привести общий формат функции передачи сообщений. Какие объекты идентифицируются этими параметрами?

Функции MPI передают указатели на переменные и массивы символов, целых и дробных чисел.
```
int Функция_MPI(
    void* buf, 
    int count, 
    MPI_Datatype datatype, 
    int dest, | int source,
    int tag,
    MPI_Comm comm,
    [MPI_Status *status]) 
```

- `void* buf` указатель на буфер с сообщением (указатель типа void в C может быть ассоциирован с любым типом данных. Он также называется указателем "общего назначения")
- `int count` количество элементов данных
- `MPI_Datatype datatype` тип элементов данных в сообщении
- `int dest` номер процесса-получателя (отправителя)
- `int tag` тег (уникальный идентификатор) сообщения
- `MPI_Comm comm` номер коммуникатора
- (`MPI_Status *status` дескриптор завершения процесса приема)

## Ссылки:
- *Как запустить MPI на нескольких кластерах через TCP:* https://habr.com/ru/company/intel/blog/251357/
- *Какие ещё сетевые протоколы поддерживаются?*
UDP/Mulicast не поддерживаются.
TCP — лишь один из поддерживаемых видов транспорта, причем не основной.
К основным относятся специфичные для [Infiniband](https://ru.wikipedia.org/wiki/InfiniBand) программно-аппаратные интерфейсы и протоколы, например, DAPL (Direct Access Programming Library).
В частности в DAPL есть режим [UD (User Datagram)](https://software.intel.com/en-us/articles/dapl-ud-support-in-intel-mpi-library), который похож по концепции на UDP.
Полный список поддерживаемых интерфейсов транспорта доступен в [Intel® MPI Library Reference Manual (на англ.)](https://software.intel.com/en-us/node/528820).
